<div class="mt-4">
  <div class="fw-bold fs-6 mb-3">Add Preparation to Checkout</div>
  <div class="d-flex flex-wrap gap-2">

    <% item.preparations.each do |preparation| %>
      <% in_checkout, available = preparation_checkout_counts(preparation, @checkout) %>

      <% checked_out = in_checkout > 0 %>
      <% if available.zero? %>
        <div class="text-muted">Temporary unavailable</div>
        <div>
          <div class="btn btn-sm btn-primary disabled d-flex align-items-center gap-1" style="cursor: not-allowed; opacity: 0.65;">
            <%= preparation.display_name %>
          </div>
        </div>
      <% elsif checked_out %>
        <div>
          <form action="<%= checkout_remove_preparation_path %>" method="post" data-turbo="true">
            <%= hidden_field_tag :id, preparation.id %>
            <%= hidden_field_tag :authenticity_token, form_authenticity_token %>

            <button type="submit" class="btn btn-sm btn-success d-flex align-items-center gap-1">
              <i class="bi bi-check-circle-fill"></i>
              <%= preparation.display_name %>
            </button>
          </form>
        </div>
      <% else %>
        <div>
          <form action="<%= checkout_add_path %>" method="post" data-turbo="true">
            <%= hidden_field_tag :id, preparation.id %>
            <%= hidden_field_tag :authenticity_token, form_authenticity_token %>

            <button type="submit" class="btn btn-sm btn-primary d-flex align-items-center gap-1">
              <i class="bi bi-square-fill"></i>
              <%= preparation.display_name %>
            </button>
          </form>
        </div>
      <% end %>
    <% end %>

  </div>
</div>
