<div id="collection_question_<%= question.id %>" class="border rounded p-3">
  <p>
    <strong><%= question.position %>. <%= strip_tags(question.question) %></strong><% if question.required? %> <span class="text-danger">*</span><% end %>
  </p>
  <% if question.question_type == "attachments" %>
    <p>
      <strong>Attachments:</strong>
      <% if answer&.attachments&.attached? %>
        <% answer.attachments.each do |attachment| %>
          <%= link_to attachment.filename.to_s, rails_blob_path(attachment, disposition: "attachment"), target: "_blank", rel: "noopener noreferrer" %>
          <%= link_to delete_attachment_path(attachment), data: { turbo_method: :get, turbo_confirm: 'Are you sure?', turbo_frame: "_top" }, class: "link_to", "aria-label": "Delete #{attachment.filename}" do %>
            <i class="bi bi-trash-fill text-danger"></i> <span class="visually-hidden">Delete</span>
          <% end %><br>
        <% end %>
      <% else %>
        <% if question.required? %>
          <span class="text-danger">Warning: This question is required but not answered.</span>
        <% else %>
          <%= "No answer provided" %>
        <% end %>
      <% end %>
    </p>
  <% else %>
    <p>
      <% plain_answer = answer.present? ? answer.answer.to_plain_text.strip.presence : nil %>
      <% if question.required? %>
        <% if plain_answer %>
          <%= plain_answer %>
        <% else %>
          <span class="text-danger">Warning: This question is required but not answered.</span>
        <% end %>
      <% else %>
        <%= plain_answer || "No answer provided" %>
      <% end %>
    </p>
  <% end %>
  <% if local_assigns[:disabled] %>
      <button class="btn btn-sm btn-outline-secondary" disabled >Edit</button>
  <% else %>
    <%= link_to edit_collection_collection_answer_path(collection, question, format: :turbo_stream), class: "link_to",
                data: {
                  controller: "modal-link",
                  turbo_frame: "modal_content_frame",
                  bs_toggle: "modal",
                  bs_target: "#sharedModal",
                  action: "click->modal-link#click keydown->modal-link#keydown",
                  modal_link_turbo_frame_value: "modal_content_frame",
                  modal_link_modal_target_value: "#sharedModal"
                },
                aria: { label: "Edit #{question}" },
                title: "Edit Question #{question.position}",
                role: "button",
                tabindex: "0" do %>
      <i class="bi bi-pencil-square text-primary"></i> <span class="body-sm-text">Edit</span>
    <% end %>
  <% end %>
</div>
