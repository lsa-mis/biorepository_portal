<div data-controller="preparation">
  <div class="d-flex overflow-auto gap-9 pb-2 pe-5 white-space-nowrap">
    <% @preparations.each_with_index do |prep, index| %>
      <button class="btn btn-outline-secondary flex-shrink-0 prep-btn"
              data-action="click->preparation#select"
              data-preparation-target="button"
              data-prep-id="<%= index %>">
        <%= prep.prep_type %>
      </button>
    <% end %>
  </div>

  <!-- Details Section -->
  <% @preparations.each_with_index do |prep, index| %>
    <div class="prep-detail d-none mt-4" data-preparation-target="detail" data-prep-id="<%= index %>">
      <div class="card p-4 shadow-sm">
        <% if prep.prep_type.present? %>
          <p><strong>Preparation Type:</strong> <%= prep.display_name %></p>
        <% end %>
        <% if prep.count.present? %>
          <p><strong>Count:</strong> <%= prep.count %></p>
        <% end %>
        <div class="mt-3">
          <h6 class="fw-semibold mb-1">Select Quantity</h6>
        </div>
        <%= form_with(url: checkout_add_path) do |form| %>
          <%= form.hidden_field :id, value: prep.id %>
          <%= form.select :count, options_for_select(1..show_count(prep, @max_number_of_preparations)), class: "form-select w-auto" %>
          <div class="mt-3">
            <%= form.submit "Add to Checkout", class: "btn btn-primary" %>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
