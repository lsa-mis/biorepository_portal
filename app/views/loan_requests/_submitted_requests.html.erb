<table class="table table-striped">
  <thead>
    <tr>
      <th>Submitted At</th>
      <th>Send To</th>
      <th>PDF</th>
      <th>CSV</th>
    </tr>
  </thead>
  <tbody>
    <% @loan_requests.each do |request| %>
      <tr>
        <td><%= request.created_at.strftime("%Y-%m-%d %H:%M") %></td>
        <td><%= request.send_to %></td>
        <td>
          <% if request.pdf_file.attached? %>
            <%= link_to 'View PDF', rails_blob_url(request.pdf_file, disposition: "inline"), target: "_blank", class: "btn btn-sm btn-outline-primary" %>
          <% else %>
            <span class="text-muted">No PDF</span>
          <% end %>
        </td>
        <td>
          <% if request.csv_file.attached? %>
            <%= link_to 'Download CSV', rails_blob_url(request.csv_file, disposition: "attachment"), target: "_blank", class: "btn btn-sm btn-outline-primary" %>
          <% else %>
            <span class="text-muted">No CSV</span>
          <% end %>
        </td>
        <td>
          <% if request.attachment_files.attached? %>
            <div class="dropdown">
              <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                Attached Files
              </button>
              <ul class="dropdown-menu">
                <% request.attachment_files.each do |file| %>
                  <li>
                    <%= link_to file.filename.to_s, rails_blob_url(file, disposition: "attachment"), class: "dropdown-item", target: "_blank" %>
                  </li>
                <% end %>
              </ul>
            </div>
          <% else %>
            <span class="text-muted">No Attachments</span>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
